{"version":3,"file":"xreplay-recorder.esm.js","sources":["../recorder/events.ts","../recorder/watcher.ts","../recorder/watchers/form-element.ts","../recorder/watchers/index.ts","../recorder/recorder.ts"],"sourcesContent":["export class EventEmitter {\n  listeners: any = {}\n  on(type: string, handler: any) {\n    this.listeners[type] = this.listeners[type] || [];\n    this.listeners[type].push(handler);\n    return this;\n  }\n  emit(type: string, data: any) {\n    for (const fn of this.listeners[type]) {\n      fn.call(this, data);\n    }\n  }\n}","import { EventEmitter } from \"./events\"\n\nexport class Watcher extends EventEmitter {\n  start(){}\n  install(options: any) {\n\n  }\n  report(data: any) {\n    return this.emit('data', data);\n  }\n  registerUninstall(fn: any) {\n    return this.on('uninstall', fn);\n  }\n  uninstall() {\n    const hooks = this.listeners['uninstall'];\n    hooks.forEach((fn: any) => fn());\n  }\n}","\nimport { Watcher } from '../watcher'\n\nenum eventTypes {\n  'input' = 'input',\n  'change' = 'change',\n  'focus' = 'focus',\n  'blur' = 'blur'\n}\n\nconst createHijacking = (context: any, handleEvent: any) => {\n  const eventListenerOptions = { once: false, passive: true, capture: true };\n  function fn(this: Window, e: Event) {\n    const eventType = e.type;\n    handleEvent(e.target, eventType);\n  };\n  const arr: any[] = [];\n  for (const type of Object.values(eventTypes)) {\n    context.addEventListener(type, fn, eventListenerOptions);\n    arr.push(() => context.removeEventListener(type, fn, eventListenerOptions));\n  }\n  const hijacking = (key: string, target: HTMLElement) => {\n    const descriptor: any = Object.getOwnPropertyDescriptor(target, key);\n    Object.defineProperty(target, key, {\n      set(value: string | boolean) {\n        setTimeout(() => handleEvent(this, key, value));\n        if (descriptor && descriptor.set) {\n          descriptor.set.call(this, value);\n        }\n      }\n    });\n    arr.push(() => Object.defineProperty(target, key, descriptor));\n  }\n  const bind = () => {\n    new Map<HTMLElement, string>([\n      [context.HTMLSelectElement.prototype, 'value'],\n      [context.HTMLTextAreaElement.prototype, 'value'],\n      [context.HTMLOptionElement.prototype, 'selected']\n    ]).forEach((target, key) => hijacking(target, key));\n\n    new Map<string, HTMLElement>([\n      ['value', context.HTMLInputElement.prototype],\n      ['checked', context.HTMLInputElement.prototype]\n    ]).forEach((target, key) => hijacking(key, target));\n  };\n  return bind();\n};\n\nfunction hijackInputs(context: any) {\n  const hijacking = createHijacking(context, (el: HTMLElement, key: string, value: any) => {\n    console.log(el, key, value);\n  });\n}\nexport class FormElementWatcher extends Watcher {\n  install({ context }: any) {\n    hijackInputs(context);\n  }\n}\n","\n// import { DOMWatcher } from './dom'\nimport { FormElementWatcher } from './form-element'\n// import { LocationWatcher } from './location'\n// import { MouseWatcher } from './mouse'\n// import { ScrollWatcher } from './scroll'\n// import { WindowWatcher } from './window'\n// import { TerminateWatcher } from './terminate'\n// import { FontWatcher } from './font'\n\n// export const baseWatchers = {\n//     DOMWatcher,\n//     FormElementWatcher,\n//     MouseWatcher,\n//     ScrollWatcher\n// };\n\n// export const watchers = {\n//     LocationWatcher,\n//     ...baseWatchers,\n//     WindowWatcher,\n//     FontWatcher,\n//     TerminateWatcher\n// };\n\nexport const allWatchers: any = [\n    // DOMWatcher,\n    FormElementWatcher,\n    // MouseWatcher,\n    // ScrollWatcher,\n    // LocationWatcher,\n    // WindowWatcher,\n    // FontWatcher,\n    // TerminateWatcher\n]","import { Watcher } from './watcher';\nimport { EventEmitter } from './events';\nimport { allWatchers } from './watchers';\n\ntype RecorderOption = {\n  disableWatchers: string[]\n};\n\nexport class Recorder extends EventEmitter {\n  options = {\n    context: window\n  }\n  watchers = []\n  constructor({ disableWatchers }: RecorderOption) {\n    super();\n    this.watchers = allWatchers\n      .filter((x: any) => disableWatchers.indexOf(x.name) === -1)\n      .map((W: any) => new W())\n    this.install();\n  }\n  install() {\n    const { options, watchers } = this;\n    console.log(watchers);\n    for (const watcher of watchers) {\n      (watcher as any).install(options);\n    }\n  }\n  start() {\n    for (const watcher of this.watchers as any) {\n      watcher.start();\n    }\n  }\n}"],"names":[],"mappings":"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"}